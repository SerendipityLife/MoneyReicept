import{a as m}from"./chunk-WF62HMP4.js";import{a as g}from"./chunk-JHTPU5XN.js";import{Ea as d,e as l,g as a,j as r,o as c,r as u,t as h}from"./chunk-TEVF6OOM.js";var D=(()=>{let i=class i{constructor(t,e){this.http=t,this.budgetService=e,this.apiUrl=g.apiUrl}uploadReceipt(t){return this.http.post(`${this.apiUrl}/receipts/upload`,t).pipe(c(e=>e.success&&e.data?this.autoAssignToTravelPlan(e.data):[e]),r(this.handleError))}autoAssignToTravelPlan(t){return this.budgetService.getTravelPlans().pipe(a(e=>{let s=new Date(t.purchaseDate),o=e.find(n=>{let v=new Date(n.startDate),f=new Date(n.endDate);return s>=v&&s<=f});return o&&this.assignReceiptToTravelPlan(t.id,o.id).subscribe({next:()=>{console.log(`\uC601\uC218\uC99D\uC774 \uC5EC\uD589 \uACC4\uD68D "${o.name}"\uC5D0 \uC790\uB3D9 \uD560\uB2F9\uB418\uC5C8\uC2B5\uB2C8\uB2E4.`)},error:n=>{console.error("\uC790\uB3D9 \uC5EC\uD589 \uACC4\uD68D \uD560\uB2F9 \uC624\uB958:",n)}}),t}),r(e=>(console.error("\uC5EC\uD589 \uACC4\uD68D \uC870\uD68C \uC624\uB958:",e),[t])))}getReceipts(t){let e="";return t&&(e="?"+new URLSearchParams(t).toString()),this.http.get(`${this.apiUrl}/receipts${e}`).pipe(a(s=>s.data),r(this.handleError))}getReceiptById(t){return this.http.get(`${this.apiUrl}/receipts/${t}`).pipe(a(e=>e.data),r(this.handleError))}getReceiptsByTravelPlan(t){return this.http.get(`${this.apiUrl}/receipts?travelPlanId=${t}`).pipe(a(e=>e.data),r(this.handleError))}assignReceiptToTravelPlan(t,e){return this.http.patch(`${this.apiUrl}/receipts/${t}/travel-plan`,{travelPlanId:e}).pipe(r(this.handleError))}removeReceiptFromTravelPlan(t){return this.http.patch(`${this.apiUrl}/receipts/${t}/travel-plan`,{travelPlanId:null}).pipe(r(this.handleError))}updateProcessingStatus(t,e){return this.http.patch(`${this.apiUrl}/receipts/${t}/status`,{status:e}).pipe(r(this.handleError))}deleteReceipt(t){return this.http.delete(`${this.apiUrl}/receipts/${t}`).pipe(r(this.handleError))}getRecentReceipts(t=5){return this.getReceipts({limit:t,page:1})}handleError(t){return console.error("ReceiptService \uC624\uB958:",t),l(()=>new Error(t.error?.message||"\uC11C\uBC84 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4."))}};i.\u0275fac=function(e){return new(e||i)(h(d),h(m))},i.\u0275prov=u({token:i,factory:i.\u0275fac,providedIn:"root"});let p=i;return p})();export{D as a};
